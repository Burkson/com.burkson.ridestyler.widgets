!function(){function e(e){this.sessionStartModel=null,this.qrWrap=document.getElementById("QR-wrap"),this.qrimg=document.getElementById("QR-img"),this.testLink=document.getElementById("desktop-test-link"),this.userStatus=document.getElementById("userStatus"),this.userStatusModal=document.getElementById("userStatusModal"),this.userImage=document.getElementById("userImage"),this.wheelBoundsWrapper=document.getElementById("wheelBoundsWrapper"),this.vehicleWrapper=document.getElementById("vehicleWrapper"),this.myInterval,this.startSession()}e.prototype.startSession=function(){var e=this;$.get("http://192.168.1.185:3000/Session/Start").done(function(t){sessionStartModel=t,qrimg.src="data:image/png;base64, "+sessionStartModel.captureQR,testLink.href=sessionStartModel.captureURL,e.myInterval=setInterval(this.checkSessionStatus,3e3)})},e.prototype.checkSessionStatus=function(){var e=this;$.get("http://192.168.1.185:3000/Session/Get",{id:sessionStartModel.session.id}).done(function(t){e.update(t)})},e.prototype.update=function(e){1==e.state?userStatus.innerHTML="":2==e.state?(userStatusModal.style.display="block",userStatus.innerHTML="Waiting for Upload..."):3==e.state?(userStatus.innerHTML="Image Loaded!",clearInterval(this.myInterval),null!=e.wheelBoundInformation&&this.showWheelBounds(e.wheelBoundInformation),null!=e.imageData&&(userImage.src=e.imageData,this.getOrientation(userImage,e.imageOrientation),userStatusModal.style.display="none",qrWrap.style.display="none")):4==e.state&&(userStatusModal.style.display="block",userStatus.innerHTML="Sorry, your session has expired.",userImage.src=e.imageData)},e.prototype.showWheelBounds=function(e){var t=JSON.parse(e);wheelBoundsWrapper.append(this.createWheelElement(t.RelativeBounds[0].Bounds)),wheelBoundsWrapper.append(this.createWheelElement(t.RelativeBounds[1].Bounds))},e.prototype.createWheelElement=function(e){var t=document.createElement("div");return t.className="wheel marker",t.style.left=100*e.X+"%",t.style.top=100*e.Y+"%",t.style.width=100*e.Width+"%",t.style.height=100*e.Height+"%",t},e.prototype.getOrientation=function(e,t){e.onload=function(){6==t?vehicleWrapper.style.cssText+="transform: rotate(90deg) translate(12.3%);":8==t?vehicleWrapper.style.cssText+="transform: rotate(-90deg) translate(12.3%);":3==t?vehicleWrapper.style.cssText+="transform: rotate(180deg) translate(0%);":0==t&&(vehicleWrapper.style.cssText+="transform: rotate(0deg);")}},window.QrCapture=e}();
