var rsqv=function(){var i=document.createElement("div");return{bind:function(e){e=e||{};for(var n=document.querySelectorAll("[data-rsqv-wheel-pn]"),c={descriptions:[],paintOptions:[],matches:[],links:[],render:{},partLookup:{},options:{defaultAngle:e.defaultAngle||"side"}},t=0;t<n.length;t++){var i=n[t],s=(i.getAttribute("data-rsqv-vehicle-desc")||e.vehicleDesc).toUpperCase(),a=c.descriptions.indexOf(s);-1===a&&(a=c.descriptions.length,c.descriptions.push(s),c.matches.push({models:null,partNumbers:[]}));var r={ele:i,index:a,loadingClass:e.buttonLoadingClass||"rsqv-button-loading"},o=i.getAttribute("data-rsqv-wheel-pn");if(void 0!==o){r.partNumbers=o.split(/[;,:|]/);for(var l=0;l<r.partNumbers.length;l++){var d=r.partNumbers[l];-1===c.matches[a].partNumbers.indexOf(d)&&c.matches[a].partNumbers.push(d)}}c.links.push(r),A(r.ele,r.loadingClass)}var u={Parameters:[],SearchOptions:2};for(t=0;t<c.descriptions.length;t++)u.Parameters.push({ID:t,Search:c.descriptions[t]});ridestyler.ajax.send({action:"Organization/GetSettings",data:{Keys:["ENABLE_SHARING","SUSPENSION_RANGES","RAWTIREDESC"]},callback:function(e){e.Success&&(c.settings=e.Settings),ridestyler.ajax.send({action:"Vehicle/Search",data:u,callback:function(e){if(e.Success){for(var n=0;n<e.Results.length;n++){for(var t=e.Results[n],i=parseInt(t.ID),s=t.Descriptions,a={},r=0,o=s.length-1;0<=o;o--){a[(d=s[o]).SideImage+"_"+d.AngledImage]=d,r=Math.max(r,d.SearchConfidence)}for(var l in c.matches[i].models=[],a){var d;(d=a[l]).SearchConfidence<r||c.matches[i].models.push(d)}}ridestyler.ajax.send({action:"Vehicle/GetPaintSchemeDescriptions",data:{VehicleConfiguration:c.matches[0].models[0].ConfigurationID},callback:function(e){e.Success&&(c.paintOptions=e.Schemes);for(var n=ridestyler.ajax.batch(),t=0;t<c.matches.length;t++)for(var i=c.matches[t],s=0;s<i.models.length;s++){var a=i.models[s];n.send(t+"_"+s,{action:"Wheel/CanBeRendered",data:{VehicleConfiguration:a.ConfigurationID,PartNumbers:i.partNumbers}})}n.execute(),n.done(function(e){for(var n in e){var t=n.split("_"),i=c.matches[t[0]],s=i.models[t[1]],a=e[n];if(a.Success)for(var r=0;r<i.partNumbers.length;r++){var o=i.partNumbers[r],l=a.PossibleTypes[o];l.Available=l.Angled||l.Side,c.render[s.ConfigurationID+"_"+o]=l}}for(r=0;r<c.links.length;r++){p(c.links[r],c)}})}})}}})}})}};function p(e,n){for(var t=e.partNumbers,i=n.matches[e.index].models.slice(),s=i.length-1;0<=s;s--){var a=i[s].ConfigurationID+"_"+t[0];0==n.render[a].Available&&i.splice(s,1)}0<i.length?e.ele.addEventListener("click",function(){!function(e,n,t){"string"==typeof e&&(e=[e]);var i=function(n,i,e){var t=sessionStorage.getItem("last-vehicle-id"),s=I(n,t);null==s&&(t=!1);var a=sessionStorage.getItem("last-paint-id")||null,r=0,o=e.options.defaultAngle;t?(r=sessionStorage.getItem("last-suspension-offset")||0,o=sessionStorage.getItem("last-angle")||o):(t=n[0].ConfigurationID,s=n[0]);var l={partNumber:i,currentAngle:o,paintOptions:e.paintOptions,settings:e.settings,models:n,suspensionOffset:r,selectedModelId:t,selectedModel:s,selectedPaintOptionId:a,selectedPaintOption:b(e.paintOptions,a),anglesAvailable:e.render};null===l.selectedModel&&(l.selectedModel=n[0],t=n[0].ConfigurationID);var d=N('<div class="rsqv-modal-wrapper"></div>');d.addEventListener("click",function(){-1!==d.className.indexOf("show")&&(q(d,"show"),setTimeout(function(){document.body.removeChild(d)},2e3))});var c=N('<div class="rsqv-modal-container"></div>');d.appendChild(c),c.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault()});var u=N('<div class="rsqv-modal-header"></div>');c.appendChild(u);var p=N('<div class="rsqv-modal-body"></div>');c.appendChild(p),l.container=c,l.header=u,l.body=p;var v=N('<div class="rsqv-tag-button left"></div>');u.appendChild(v),v.innerHTML="<em>"+l.selectedModel.Year+" "+l.selectedModel.MakeName+" "+l.selectedModel.ModelName+"</em><strong>"+l.selectedModel.TrimName+"</strong>",u.appendChild(function(u){var e=N('<div class="rsqv-tag-button right"></div>'),n=N('<div class="rsqv-control-wrapper"></div>');e.appendChild(n);var t=u.anglesAvailable[u.selectedModelId+"_"+u.partNumber];t&&t.Angled&&t.Side&&n.appendChild(C("Rotate","rsicon-rotate",!1,function(e){u.changeAngle("side"==u.currentAngle?"angle":"side")},u));return n.appendChild(C("Suspension","rsicon-suspension",function(e){var n=u.settings.SUSPENSION_RANGES,t=-4,i=0,s=parseInt(u.suspensionOffset),a=u.selectedModel.StyleType+u.selectedModel.DriveType;void 0!==n&&null!=n&&(void 0!==n[a]?(t=n[a].Min,i=n[a].Max):void 0!==n.Default&&(t=n.Default.Min,i=n.Default.Max)),s<t?s=t:i<s&&(s=i);var r=N('<i class="rsicon-minus-circle"></i>',e),o=N('<span class="rsqv-output">'+s+"</span>",e),l=N('<i class="rsicon-plus-circle"></i>',e);function d(){(s<=t?A:q)(r,"disabled"),(i<=s?A:q)(l,"disabled")}function c(e){e<t||i<e||(u.changeSuspensionOffset(s=e),d(),o.innerText=s)}d(),l.addEventListener("click",function(){c(s+1)}),r.addEventListener("click",function(){c(s-1)})},u)),n.appendChild(C("Paint","rsicon-paint",function(n){for(var e=0;e<u.paintOptions.length;e++)!function(e){N('<div class="rsqv-paint-swatch" style="background-color: '+e.Colors[0].Hex+';"></div>',n).addEventListener("click",function(){u.changePaint(S(e))})}(u.paintOptions[e])},u)),u.container.addEventListener("click",function(){for(var e=document.querySelectorAll(".rsqv-control-menu.show"),n=0;n<e.length;n++)q(e[n],"show")}),e}(l));var f=N('<div class="rsqv-modal-viewport"></div>');p.appendChild(f);var h=N('<div class="rsqv-modal-disclaimer"></div>');p.appendChild(h),1<n.length&&h.appendChild(function(l,d){var e=N("<a href='#'>Not your vehicle? Click here to change trim options.</a>");return e.addEventListener("click",function(){for(var n=N('<div class="rsqv-modal-overlay"></div>',l),e=N('<table class="rsqv-trim-selection"></table>',n),t=[],i=null,s=0;s<4;s++){s%2==0&&(i=document.createElement("tr"),e.appendChild(i));var a=document.createElement("td");if(i.appendChild(a),s<d.models.length){var r=d.models[s],o=N('<div class="rsqv-trim-wrapper"></div>',a);t.push(m(o,r.ConfigurationID)),function(e){o.addEventListener("click",function(){d.changeVehicle(e.ConfigurationID),q(n,"show"),setTimeout(function(){n.parentElement.removeChild(n)},500)})}(r)}}setTimeout(function(){A(n,"show")},10)}),e}(p,l));var g=new RideStylerViewport(f,{containerAspectRatio:.42});return l.refresh=function(){var e=l.anglesAvailable[l.selectedModelId+"_"+i],n=l.currentAngle;"side"!=l.currentAngle||e.Side?"angle"!=l.currentAngle||e.Angled||(n="side"):n="angle";var t={PositionX:1,PositionY:2,Suspension:l.suspensionOffset,VehicleConfiguration:l.selectedModelId,WheelPartNumber:i,ExcludeDiscontinuedWheels:!0,Type:n};l.selectedPaintOption&&(t.PaintColor=l.selectedPaintOption.Colors[0].Hex),g.Update(t)},l.changeAngle=function(e){sessionStorage.setItem("last-angle",l.currentAngle=e),l.refresh()},l.changeSuspensionOffset=function(e){sessionStorage.setItem("last-suspension-offset",l.suspensionOffset=e),l.refresh()},l.changePaint=function(e){sessionStorage.setItem("last-paint-id",l.selectedPaintOptionId=e),l.selectedPaintOption=b(l.paintOptions,e),l.refresh()},l.changeVehicle=function(e){sessionStorage.setItem("last-vehicle-id",l.selectedModelId=e),l.selectedModel=I(n,e),l.refresh()},l.changeVehicle(t),d}(e,n,t);document.body.appendChild(i),setTimeout(function(){A(i,"show")},10)}(i,t[0],n)}):A(e.ele,"rsqv-button-disabled"),q(e.ele,e.loadingClass),A(e.ele,"rsqv-button-ready")}function m(e,n){var t=new RideStylerViewport(e,{responsive:!1});return setTimeout(function(){t.Update({PositionX:1,PositionY:2,VehicleConfiguration:n})},10),t}function C(e,n,t,i,a){var r=N('<div class="rsqv-control"></div>');if(r.appendChild(N('<i class="'+n+'"></i>')),r.appendChild(N('<div class="rsqv-title">'+e+"</div>")),!1===t)r.addEventListener("click",i);else{a=i;var o=N('<div class="rsqv-control-menu"></div>');t(N('<div class="rsqv-menu-content"></div>',o),o),r.addEventListener("click",function(e){var n=r.getBoundingClientRect(),t=a.container.getBoundingClientRect(),i=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left")),s=t.right-n.right+r.clientWidth/2-i/2;o.style.left=o.style.right=s+"px",o.style.top=n.top-t.top+r.offsetHeight+17+"px",function(e){for(var n=!1,t=document.querySelectorAll(".rsqv-control-menu.show"),i=0;i<t.length;i++)q(t[i],"show"),t[i]===e&&(n=!0);return n}(o)||A(o,"show"),e.stopPropagation()}),o.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()}),a.container.appendChild(o)}return r}function S(e){var n=e.VehiclePaintSchemeID;return"00000000-0000-0000-0000-000000000000"===n&&(n=e.SchemeName),n}function b(e,n){for(var t=0;t<e.length;t++)if(e[t].VehiclePaintSchemeID==n||e[t].SchemeName==n)return e[t];return null}function I(e,n){for(var t=0;t<e.length;t++)if(e[t].ConfigurationID==n)return e[t];return null}function N(e,n){i.innerHTML=e;var t=i.firstChild;return n&&n.appendChild(t),t}function A(e,n){-1===e.className.indexOf(n)&&(e.className+=" "+n)}function q(e,n){-1!==e.className.indexOf(n)&&(e.className=e.className.replace(n,""))}}();