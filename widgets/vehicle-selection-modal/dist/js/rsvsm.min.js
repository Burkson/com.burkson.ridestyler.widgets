function RideStylerVehicleSelectionModal(e){function t(e){e=e||{};for(var t=1;t<arguments.length;t++)if(arguments[t])for(var n in arguments[t])arguments[t].hasOwnProperty(n)&&(e[n]=arguments[t][n]);return e}function n(e,t){if(e){"string"==typeof e?e=document.querySelectorAll(e):e.tagName&&(e=[e]);for(var n=0;n<e.length;n++)""==e[n].className.trim()?e[n].className=t:(" "+e[n].className+" ").indexOf(" "+t+" ")<0&&(e[n].className+=" "+t)}}function o(e,t){if(e){"string"==typeof e?e=document.querySelectorAll(e):e.tagName&&(e=[e]);for(var n=new RegExp(" "+t+" ","g"),o=new RegExp("(^)"+t+"($| )","g"),i=new RegExp("(^| )"+t+"($)","g"),l=0;l<e.length;l++)e[l].className=e[l].className.replace(n," "),e[l].className=e[l].className.replace(o,""),e[l].className=e[l].className.replace(i,""),""==e[l].className.trim()&&e[l].removeAttribute("class")}}function i(e,t){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1});e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null}function l(){if(!document.getElementById("vsm-backdrop")){var e=document.createElement("div");e.id="vsm-backdrop",e.style.opacity=0,e.style.transition="opacity linear .3s",document.body.appendChild(e),a()}}function a(){var e=document.getElementById("vsm-backdrop");e||l(),setTimeout(function(){e.style.opacity=.55,e.onTransitionEndOnce(function(){})},0)}function r(){var e=document.getElementById("vsm-backdrop");e&&(e.style.opacity=0,e.onTransitionEndOnce(function(){e.parentNode.removeChild(e)}))}function s(){var t=document.querySelectorAll(".vsm-modal:not(#vsm_modal_base)"),n=document.querySelectorAll(".vsm-modal.in")[0],o=p.slice(0),i=h.slice(0);p=[],h=[],b=!0,y.indexOf(n.getAttribute("id"))>-1?(n.style.opacity=0,n.onTransitionEndOnce(function(){[].forEach.call(t,function(e){var t=e.getAttribute("id");y.indexOf(t)>-1&&e.parentNode.removeChild(e)});for(var n={},l=0;l<o.length;l++){var a=o[l].split(":");2==a.length&&(n[a[0]]=a[1])}if(e.callback&&"function"==typeof e.callback){var r={FinalSelectionMade:!1,Vehicle:n,FullSelectionData:i};e.callback(r)}else console.warn("No callback function provided.")}),r()):console.warn("This vsm instance is not shown yet.")}function c(){if(!document.getElementById("vsm_modal_base")){var e=document.createElement("div");e.innerHTML=vsm_template,document.body.appendChild(e.firstChild)}}function d(n,o,i){var l=document.getElementById("vsm_modal_base");if(l){var a=l.cloneNode(!0);if(a.id="vsm_modal_"+_vsmModalIDCounter,y.push("vsm_modal_"+_vsmModalIDCounter),a.className+=" vsm_modal_"+_vsmModalIDCounter,document.body.appendChild(a),void 0!==i){o=t({backModal:i,thisModal:a},o);var r=a.querySelectorAll(".vsm-back-step");[].forEach.call(r,function(t){var n=function(t){t.target.removeEventListener(t.type,n);var i=o.backModal,l=o.thisModal;m(i,l,!0).then(function(){if(p.length&&p.pop(),h.length&&h.pop(),l.parentNode&&l.parentNode.removeChild(l),e.afterBackClicked&&"function"==typeof e.afterBackClicked){for(var t={},n=0;n<p.length;n++){var o=p[n].split(":");2==o.length&&(t[o[0]]=o[1])}var i={FullSelection:t,FullSelectionData:h};e.afterBackClicked(i)}})};t.addEventListener("click",n,!1)})}"function"==typeof n&&n(a,o);var c=a.querySelectorAll(".vsm-close");return[].forEach.call(c,function(e){e.onclick=function(){s()}}),_vsmModalIDCounter++,a}}function m(e,t,i){if(i=!!i,e&&t){var l,a;if(!i){var r=parseInt(t.style.zIndex,10)||0,s=parseInt(e.style.zIndex,10)||0;s<=r&&(s=r+1),e.style.zIndex=s}return g?i?(e.style.display="block",n(e,"in"),a=new Promise(function(e,t){e()}),l=new Promise(function(e,n){setTimeout(function(){o(t,"in"),t.onTransitionEndOnce(function(){t.style.display="none",e()})},50)})):(e.style.display="block",a=new Promise(function(i,a){setTimeout(function(){n(e,"in"),e.onTransitionEndOnce(function(){t.style.display="none",o(t,"in"),i(),l=new Promise(function(e,t){e()})})},50)})):i?(e.style.display="block",n(e,"in"),a=new Promise(function(e,t){e()}),o(t,"in"),t.style.display="none",l=new Promise(function(e,t){e()})):(e.style.display="block",a=new Promise(function(e,t){e()}),n(e,"in"),t.style.display="none",o(t,"in"),l=new Promise(function(e,t){e()})),Promise.all([l,a]).then(function(e){}).catch(function(e){console.warn(e)})}}function u(e){var t={Selection:h};ridestyler.ajax.send({action:"Vehicle/Select",data:t,callback:function(t){t.Success&&(t.BestConfiguration?f(e,t.BestConfiguration):v(e,t.Menu))}})}function v(t,o){var i=t.querySelectorAll(".vsm-list-container")[0],l=t.querySelectorAll(".vsm-header")[0],a=t.querySelectorAll(".vsm-modal-body")[0],r=t.querySelectorAll(".vsm-line-step")[0],s=t.querySelectorAll(".vsm-final")[0],c=function(n){var o=n.getAttribute("data-optionvalue"),i=n.getAttribute("data-optionkey"),l=n.getAttribute("data-optionlabel"),a=n.getAttribute("data-menutitle");if(h.push(i+":"+o),p.push(a+":"+l),e.afterOptionSelected&&"function"==typeof e.afterOptionSelected){for(var r={},s=0;s<p.length;s++){var c=p[s].split(":");2==c.length&&(r[c[0]]=c[1])}var v={CurrentSelection:{},FullSelection:r,FullSelectionData:h};v.CurrentSelection[a]=l,e.afterOptionSelected(v)}b||m(d(u,{},t),t)};s.parentNode.removeChild(s),n(r,"vsm-single-step");var v=o.Options,f=o.Key,y=o.Title,g=document.createElement("div"),A=document.createElement("i"),E=document.createElement("span");if(g.className="vsm-column-2",A.className="dot-style dot-before active",E.className="dot-info dot-info-before active",E.innerHTML=y,g.appendChild(A),g.appendChild(E),h.length){n(a,"vsm-has-back");var _=document.createElement("div"),S=document.createElement("span"),C=document.createElement("span");_.className="vsm-column-2 no-style vsm-table",S.className="vsm-table-cell",C.className="vsm-selected-info",S.appendChild(C),_.appendChild(S);var k=p.map(function(e){return e&&2===e.split(":").length?e.split(":")[1]:""});C.innerHTML=k.join(" "),r.appendChild(_),r.appendChild(g)}else(_=document.createElement("div")).className="vsm-column-2 no-style",r.appendChild(_),r.appendChild(g);for(l.innerHTML=o.Description;i.firstChild;)i.removeChild(i.firstChild);if(v.length){var w=document.createElement("div");w.className="vsm-group-wrap center-piece",i.appendChild(w);var T=document.createElement("div");T.className="vsm-group-list vsm-one-container",w.appendChild(T);for(var N=0;N<v.length;N++){var M=v[N],I=M.Label,x=M.Value;if(void 0!==I&&void 0!==x){var O=document.createElement("a"),F=document.createTextNode(I);O.className="vsm-option-item vsm-btn vsm-btn-gray",O.href="javascript:void(0)",O.setAttribute("data-optionvalue",x),O.setAttribute("data-optionkey",f),O.setAttribute("data-optionlabel",I),O.setAttribute("data-menutitle",y),O.appendChild(F),T.appendChild(O),O.onclick=function(){c(this)}}}}}function f(o,l){var a=o.querySelectorAll(".vsm-vehicle-display")[0],c=o.querySelectorAll(".vsm-final .vsm-loaderIcon")[0],d=o.querySelectorAll(".vehicle-result-name")[0],m=(o.querySelectorAll(".vehicle-result-size")[0],o.querySelectorAll(".vsm-find")[0]),u=o.querySelectorAll(".vsm-modal-body")[0],v=o.querySelectorAll(".vsm-in-progress")[0];n(u,"vsm-has-back"),m.innerHTML=e.ConfirmButtonText;for(var f=[],y={},b=0;b<p.length;b++){var g=p[b].split(":");2==g.length&&(f.push(g[1]),y[g[0]]=g[1])}for(var A=f[0],E=f.pop(),b=1;b<f.length&&!(b>=3);b++)A+=" "+f[b];var _=A+" "+E;d.innerHTML=_,n(o.querySelectorAll(".vsm-modal-body")[0],"vsm-final-screen"),v.parentNode.removeChild(v);var S={Width:260,Height:120,PositionX:1,PositionY:1};e.ImageSettings&&t(S,e.ImageSettings),S.VehicleConfiguration=l.Value;var C=ridestyler.ajax.url("Vehicle/Render",S);a.src=C,a.style.display="inline-block",a.onload=function(){c.style.display="none"};var k=function(n){n.target.removeEventListener(n.type,k);var o=document.querySelectorAll(".vsm-modal:not(#vsm_modal_base)"),a=i(this,".vsm-modal"),c=h.slice(0);p=[],h=[],a.style.opacity=0,a.onTransitionEndOnce(function(){[].forEach.call(o,function(e){e.parentNode.removeChild(e)});var n={ImageUrl:C,VehicleDescription:_,VehicleConfiguration:l.Value};if(t(n,y),e.callback&&"function"==typeof e.callback){var i={FinalSelectionMade:!0,Vehicle:n,FullSelectionData:c};e.callback(i)}else s(),console.warn("No callback function provided.")}),r()};m.addEventListener("click",k,!1)}var p=[],h=[],y=[],b=!1;e=t({ConfirmButtonText:"Confirm Vehicle",afterBackClicked:null,afterOptionSelected:null,callback:null},e);var g=function(){var e=(document.body||document.documentElement).style;return void 0!==e.WebkitTransition||void 0!==e.MozTransition||void 0!==e.OTransition||void 0!==e.transition}();!function(){var e,t=document.createElement("div"),n={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},o="";for(e in n)if(n.hasOwnProperty(e)&&void 0!==t.style[e]){o=n[e];break}HTMLElement.prototype.onTransitionEndOnce=function(e){if(""===o)return e(),this;var t=function(n){e(),n.target.removeEventListener(n.type,t)};return this.addEventListener(o,t,!1),this}}(),this.Show=function(){if(c(),document.querySelectorAll(".vsm-modal:not(#vsm_modal_base)").length)console.warn("There is currently another vsm instance running.");else{var e=d();l(),e.style.display="block",b=!1,setTimeout(function(){n(e,"in"),e.onTransitionEndOnce(function(){u(e)})},50)}},this.Hide=s}var vsm_template='<div id="vsm_modal_base" class="vsm-modal vsm-hide vsm-fade" style="z-index: 9999;" tabindex="-1" role="dialog"> <div class="vsm-modal-container"> <div class="vsm-modal-header"> <button type="button" class="vsm-close"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAARVBMVEUAAACdnZ2ampqbm5ubm5uampqdnZ2ZmZmZmZmZmZmcnJyZmZmZmZmdnZ2ZmZmZmZmbm5uZmZmbm5ubm5uZmZmcnJybm5v/bA1VAAAAF3RSTlMAFL8yOr0Qz//tMvHLEs3zNO8wNuswLru4YpkAAADeSURBVHgBvdUFisQAEETRjrvL/W+6Em8+1PoWNpO8H5y2/1oQRhrESep8lhel9FVeN87nvqDP87ZxXhVxt4GsuT0K+K0Itv9hnrOA3xZuD/rBFcIXkZku6HVBrwt6XdDrgl4V8KOZLui5yRf0unj4md5YPPxiHAt6XdDrQntRzCsFC3i9sriDLv6a1wW9Luh1QS8L+mGWBf20yoLeTBf0sqDftogCnoX0opDebCxcIT2KKhZeFtHD94axCKV3H0zcyYJHUad2FvAocEbhUWTuUMOj2PxdhN6zCAP7p70CQy4hRTemab0AAAAASUVORK5CYII=" style="width:24px;"></button> </div><div class="vsm-modal-body vsm-option-body vsm-list-body"> <a href="javascript:void(0);" class="vsm-back-link vsm-back-step">❮ </a> <div class="vsm-in-progress"> <p class="vsm-header vsm-center"></p><div class="vsm-line-step center-piece vsm-columns"> </div><div class="vsm-list-container scrollable"><i class="vsm-loaderIcon" alt="Loading options"></i></div></div><div class="vsm-final"> <div class="center-piece vsm-line-step vehicle-result-wrap"> <i class="dot-style dot-before active"></i> <p class="vehicle-result-name"></p><p class="vehicle-result-size"></p></div><div class="scrollable"> <div class="center-piece vehicle-image-wrap"> <div style="position: relative; text-align: center; min-height: 120px;"> <i class="vsm-loaderIcon" alt="Loading an image of your vehicle"></i> <img src="" alt="" class="vsm-vehicle-display" style="display: none;"> </div><a href="javascript:void(0);" class="vsm-btn vsm-btn-gray vsm-full-width vsm-find"></a> </div></div></div></div></div></div>';!function(e){function t(){}function n(e,t){return function(){e.apply(t,arguments)}}function o(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function i(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void o._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var o;try{o=n(e._value)}catch(e){return void a(t.promise,e)}l(t.promise,o)}else(1===e._state?l:a)(t.promise,e._value)}))}function l(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if(t instanceof o)return e._state=3,e._value=t,void r(e);if("function"==typeof i)return void c(n(i,t),e)}e._state=1,e._value=t,r(e)}catch(t){a(e,t)}}function a(e,t){e._state=2,e._value=t,r(e)}function r(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)i(e,e._deferreds[t]);e._deferreds=null}function s(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function c(e,t){var n=!1;try{e(function(e){n||(n=!0,l(t,e))},function(e){n||(n=!0,a(t,e))})}catch(e){if(n)return;n=!0,a(t,e)}}var d=setTimeout;o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,n){var o=new this.constructor(t);return i(this,new s(e,n,o)),o},o.all=function(e){var t=Array.prototype.slice.call(e);return new o(function(e,n){function o(l,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var r=a.then;if("function"==typeof r)return void r.call(a,function(e){o(l,e)},n)}t[l]=a,0==--i&&e(t)}catch(e){n(e)}}if(0===t.length)return e([]);for(var i=t.length,l=0;l<t.length;l++)o(l,t[l])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(e){return new o(function(t,n){n(e)})},o.race=function(e){return new o(function(t,n){for(var o=0,i=e.length;o<i;o++)e[o].then(t,n)})},o._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){d(e,0)},o._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},o._setImmediateFn=function(e){o._immediateFn=e},o._setUnhandledRejectionFn=function(e){o._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=o:e.Promise||(e.Promise=o)}(this);var _vsmModalIDCounter=0;